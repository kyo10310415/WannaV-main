
// API: SSOç”¨ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
app.post('/api/generate-sso-token', authMiddleware, async (c) => {
  try {
    const user = c.get('user');
    const { targetUrl } = await c.req.json();

    // SSOç”¨ã®ä¸€æ™‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆï¼ˆæœ‰åŠ¹æœŸé™5åˆ†ï¼‰
    const ssoToken = jwt.sign(
      {
        userId: user.id,
        username: user.username,
        role: user.role,
        targetUrl: targetUrl,
        type: 'sso'
      },
      JWT_SECRET,
      { expiresIn: '5m' }
    );

    console.log(`ğŸ”‘ SSO ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ: ${user.username} â†’ ${targetUrl}`);

    return c.json({ success: true, token: ssoToken });
  } catch (error) {
    console.error('âŒ SSO token generation error:', error);
    return c.json({ error: 'ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' }, 500);
  }
});
